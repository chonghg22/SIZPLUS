<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<sql id="listWhere">
		<if test="schStr != null and schStr != ''">
		<choose>
			<when test="schFld == '1'.toString()">
			and	a.title like concat('%' , #{schStr} , '%')
			</when>
			<when test="schFld == '2'.toString()">
			and	a.input_nm like concat('%' , #{schStr} , '%')
			</when>
			<otherwise>
			and	(
				a.title like concat('%' , #{schStr} , '%')
				or
				a.input_nm like concat('%' , #{schStr} , '%')
			)
			</otherwise>
		</choose>
		</if>
<!-- 		<if test="bbsId == 'faq' and typeEtc !=null and typeEtc !=''"> -->
<!-- 		and a.type_etc = #{typeEtc} -->
<!-- 		</if> -->
<!-- 		<if test="openYn != null and openYn !=''"> -->
<!-- 		and a.open_yn = #{openYn} -->
<!-- 		</if> -->
	</sql>
	
	<select id="selectBoardList" parameterType="hashmap" resultType="hashmap">
		select
			a.seq,
			a.bbs_id,
			a.open_yn,
			a.title,
			a.contents,
			a.input_nm,
			a.input_ip,
			a.input_date,
			a.edit_ip,
			a.edit_date,
			a.good_cnt,
			a.hit
		from e_board a
		where
		bbs_id = #{bbsId}
		<include refid="listWhere" />
		order by seq desc
		limit #{firstIndex}, #{recordCountPerPage}
	</select>
	
	<select id="selectBoardCnt" parameterType="hashmap" resultType="int">
		select
			count(*) cnt
		from e_board a
		where
		a.bbs_id = #{bbsId}
		<include refid="listWhere" />
	</select>
	
	<select id="selectBoardView" parameterType="hashmap" resultType="hashmap">
		select
			a.seq,
			a.bbs_id,
			a.open_yn,
			a.title,
			a.contents,
			a.input_nm,
			a.input_ip,
			a.input_date,
			a.edit_ip,
			a.edit_date,
			a.good_cnt,
			a.bad_cnt,
			a.hit
		from e_board a
		where 
		a.bbs_id = #{bbsId}
		and
		a.seq = #{seq}
	</select>
	
	<insert id="insertBoard">
		insert into e_board(
			bbs_id,
			open_yn,
			title,
			contents,
			password,
			input_nm,
			input_date
		)values(
			#{bbsId},
			'Y',
			#{title},
			#{contents},
			#{password},
			#{inputNm},
			now()
		)
	</insert>
	
	<update id="updateBoard">
		update e_board set
			title = #{title},
			contents = #{contents},
			password = #{password},
			edit_date = now()
		where
			seq = #{seq}
		
	</update>
	
	<update id="updateBoardHitCount">
		update e_board set
			hit = hit +1
		where 
			seq = #{seq}
	</update>
	
	<update id="updateBoardGoodCount">
		update e_board set
			good_cnt = good_cnt +1
		where 
			seq = #{seq}
	</update>
	
	<update id="updateBoardBadCount">
		update e_board set
			bad_cnt = bad_cnt +1
		where 
			seq = #{seq}
	</update>
	
	<delete id="deleteBoard">
		delete from e_board where seq = #{seq}
	</delete>
	
</mapper>